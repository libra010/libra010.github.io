Java底层规范





## Java内存模型（JMM）

Java 内存模型（Java Memory Model，JMM）是 Java **并发编程**的底层规范（基于 **JSR-133**），它定义了多线程程序中各个线程如何通过主内存进行交互，以及如何保证变量的可见性、有序性和原子性。

JMM 屏蔽了不同硬件架构和操作系统在**内存访问机制**上的差异，为 Java 程序提供了一套统一的内存可见性保证，从而使开发者能够在不同平台上编写出行为一致的并发程序。

**共享变量的可见性**：确保一个线程对共享变量的修改能够及时被其他线程感知和读取。Java 中可通过 `volatile` 关键字实现，被 `volatile` 修饰的变量在每次读取时都会从主内存刷新，写入时也会立即同步回主内存，从而保证可见性。此外，`synchronized` 和 `final` 等机制也能提供可见性保证。

**执行顺序的有序性**：指程序执行的顺序在多线程环境下不会因编译器优化或处理器指令重排序而被破坏。JMM 通过 **happens-before** 原则来定义操作之间的偏序关系，确保前一个操作的结果对后续操作可见。这种有序性在底层依赖内存屏障（Memory Barrier）来实现，防止特定类型的重排序。

**操作的原子性**：指一个操作或一段代码在执行过程中不可被中断，要么全部执行完成，要么完全不执行。例如，`synchronized` 关键字通过加锁机制保证了代码块的原子性；而 `java.util.concurrent.atomic` 包中的原子类则利用 CAS 操作实现单个变量读-改-写过程的原子性。





## JVM运行时数据区

Java 虚拟机**运行时数据区**（Runtime Data Areas）是《Java 虚拟机规范》中定义的 JVM 在运行时所管理的内存区域划分，它为 Java 程序的执行提供了内存运行环境。

根据规范，运行时数据区主要包括以下组成部分：

**程序计数器（Program Counter Register）**：线程私有。

**Java 虚拟机栈（Java Virtual Machine Stacks）**：线程私有。

**本地方法栈（Native Method Stack）**：线程私有，为Native本地方法服务。

**堆（Heap）**：所有线程共享，用于存放对象实例和数组。

**方法区（Method Area）**：所有线程共享，存储类结构信息。







END