分布式架构幂等性



在软件工程分布式系统架构中，因为网络问题，重试（Retry） 是不可避免且必要的机制，用于提高系统的可靠性和可用性。正因为重试是必要的，所以幂等性是极其重要的要求，特别对于涉及状态变更的操作。



RPC调用，消息队列等等都应该具有幂等性。



幂等性的定义是：对同一个资源，一次请求和多次请求的结果（对系统状态的影响）是相同的。



天然幂等的操作，在查询操作（HTTP Get，SQL select），一些更新操作（HTTP Put，SQL update set field = xx）是天然幂等的，不需要关注幂等性的要求。



单体架构中的JDBC操作也应该是幂等的，但是JDBC操作是阻塞式的，线程阻塞等待结果并不会主动重试，而且数据库原子性事务能保证操作失败不改变状态。一般不考虑幂等性，但是业务层面，比如前端重复点击，封装JDBC的RPC调用，框架层的Spring Retry都有可能导致JDBC重试。这应该在业务层面进行幂等性的设计。

